---
import About from "../components/About.astro";
import Bonus from "../components/Bonus.astro";
import CTA from "../components/CTA.astro";
import Depos from "../components/Depos.astro";
import FAQ from "../components/FAQ.astro";
import Furadeira from "../components/Furadeira.astro";
import Furadeira2 from "../components/Furadeira2.astro";
import Conteudo from "../components/Conteudo.astro";
import Posthog from "../components/posthog.astro";
import PreCheckout from "../components/Precheckout.astro";
import YoutubePlayer from "../components/yt-player";
import Layout from "../layouts/Layout.astro";
import { createId } from "@paralleldrive/cuid2";

let uuid = createId();
if (!Astro.cookies.get("uuid")) {
  Astro.cookies.set("uuid", uuid, {
    maxAge: 365 * 24 * 60 * 60,
    path: "/",
  });
}
let clientUuid = Astro.cookies.get("uuid");
let today = new Date();
let expirationDate = new Date("2025-05-02T10:00:00-03:00");
let warningText = "Oferta v√°lida de 28/11 a 01/12";
let searchParams = Astro.url.searchParams;
const utmTags = [
  "utm_source",
  "utm_medium",
  "utm_campaign",
  "utm_content",
  "utm_term",
];
let sckValuesArray = utmTags.map((tag) => {
  if (searchParams.get(tag) && searchParams.get(tag) !== "") {
    return searchParams.get(tag);
  }
  return null;
});
console.log(sckValuesArray);

const sckValues = sckValuesArray.filter((value) => value !== null).join("-");
console.log(sckValues);

// console.log(clientUuid);
---

<Layout>
  <main class="max-w-[1080px] mx-auto">
    <script is:inline>
      window.posthog.capture("pageview");
    </script>
    <!-- <div
      class="text-md font-bold text-center text-cream bg-red-400 fixed top-0 left-0 w-full z-10"
    >
      Agosto Dourado - R$100 OFF + B√îNUS <br /> Somente hoje 19/08/2025
    </div> -->
    <div
      class="text-md font-bold text-center text-cream bg-red-400 fixed top-0 left-0 w-full z-10"
    >
      De R$297 por R$197 ‚Äî 28/11 a 01/12
    </div>
    <section class="w-full bg-blue p-4 text-cream rounded-lg shadow-lg">
      <div class="flex flex-col items-center text-center gap-4">
        <div class="w-[180px] sm:w-[300px]">
          <img
            src="/logo-portrait-v2.svg"
            alt="logo"
            width={300}
            height={120}
          />
        </div>
        <div class="text-6xl">
          <h1
            class="text-3xl sm:text-5xl font-extrabold text-amber-100 uppercase text-cream"
          >
            Oferta Oficial de <br />
            <span class="text-red-400 sm:text-7xl"> Black Friday </span>
            <br />
            <span class="text-green sm:text-7xl"> LactoBlack </span>
          </h1>
        </div>

        <div class="mt-4">
          <h2 class="text-2xl font-semibold mb-2">
            üë∂ Voc√™ n√£o precisa passar por isso sozinha
          </h2>
          <div class="card bg-cream text-blue font-black shadow-lg">
            <div class="card-body flex flex-col items-center">
              <p class="text-lg">Precisa de produ√ß√£o real.</p>
              <p class="text-lg">Precisa sair da f√≥rmula.</p>
              <p class="text-lg">Precisa de apoio e m√©todo.</p>
            </div>
          </div>
        </div>

        <div class="mt-4 flex flex-col items-center">
          <h2 class="text-2xl font-semibold mb-2">
            üåë Por isso come√ßou a{" "}
            <span class="font-bold">
              Oferta Oficial de Black Friday do LactoFlow¬Æ
            </span>
          </h2>
          <div class="card bg-cream text-blue shadow-lg">
            <div class="card-body flex flex-col items-start">
              <p class="text-left text-2xl font-semibold mb-2">
                Para m√£es que:
              </p>
              <ul class="list-none text-left text-lg space-y-1">
                <li>
                  ‚Äì Querem produzir mais <span class="font-semibold">leite</span
                  >
                </li>
                <li>
                  ‚Äì Est√£o usando <span class="font-semibold">f√≥rmula</span>, mas
                  querem parar
                </li>
                <li>
                  ‚Äì Querem se preparar para uma <span class="font-semibold"
                    >amamenta√ß√£o</span
                  > tranquila
                </li>
                <li>
                  ‚Äì E querem garantir o <span class="font-semibold"
                    >melhor pre√ßo</span
                  > do ano
                </li>
              </ul>
            </div>
          </div>

          <div class="mt-4">
            <div class="card bg-cream text-blue shadow-lg">
              <div class="card-body flex flex-col items-start">
                <h2 class="text-left text-2xl font-semibold mb-2">
                  ‚úÖ O que voc√™ vai receber ao entrar no LactoFlow¬Æ:
                </h2>
                <ul class="list-none text-left text-lg space-y-1">
                  <li>
                    - Acesso imediato ao <span class="font-semibold"
                      >curso completo</span
                    > LactoFlow
                  </li>
                  <li>
                    - Acesso √† <span class="font-semibold"
                      >Clara, sua assistente de IA</span
                    > exclusiva
                  </li>
                  <li>
                    - Suporte di√°rio comigo na <span class="font-semibold"
                      >comunidade exclusiva</span
                    >
                  </li>
                  <li>
                    - 2 encontros <span class="font-semibold">ao vivo</span> por
                    m√™s
                  </li>
                  <li>
                    - Chance de ganhar 1 dos 5 <span class="font-semibold"
                      >Kits F√≠sicos</span
                    > (primeiras alunas)
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="mt-4 card bg-cream text-blue shadow-lg">
            <div class="card-body flex flex-col items-start">
              <h2 class="text-left text-2xl font-semibold mb-2">
                üéÅ B√îNUS EXCLUSIVOS da LactoBlack:
              </h2>
              <ul
                class="list-none text-lg space-y-1 text-left max-w-lg mx-auto pl-4"
              >
                <li>
                  üéì{" "}
                  <span class="font-semibold">
                    Novidade: Clara, a Assistente de IA
                  </span>
                  <br /> Sua rotina personalizada e hor√°rios ajustados pelo seu beb√™
                  <div class="mt-4"></div>
                  <li class="mt-2">
                    ü§∞ <span class="font-semibold">Workshop para Gestantes</span
                    >
                    <br /> Prepara√ß√£o emocional, pr√°tica e segura antes do beb√™ nascer
                  </li>
                  <li class="mt-2">
                    üì¶{" "}
                    <span class="font-semibold">
                      Workshop de Estoque de Leite Materno
                    </span>
                    <br /> Como organizar a rotina e voltar ao trabalho sem desmamar
                  </li>

                  <li class="mt-2">
                    üåô <span class="font-semibold"
                      >Workshop de Desmame Gentil</span
                    >
                    <br /> Noturno e Total: Para quando voc√™ decidir parar com seguran√ßa
                  </li>
                  <li class="mt-2">
                    üßò‚Äç‚ôÄÔ∏è{" "}
                    <span class="font-semibold"
                      >Medita√ß√£o Guiada ‚Äì Meu Corpo Produz</span
                    >
                    <br /> Pra se conectar com seu corpo e confiar na sua produ√ß√£o
                  </li>
                  <li class="mt-2">
                    üìÑ <span class="font-semibold">PDFs b√¥nus:</span>
                    <ul class="list-disc pl-5 mt-1">
                      <li>Guia: O beb√™ est√° mamando bem?</li>
                      <li>Di√°rio de fraldas do rec√©m-nascido</li>
                      <li>Manual da pega correta</li>
                    </ul>
                  </li>
                </li>
              </ul>
            </div>
          </div>

          <div class="mt-4">
            <div class="card bg-cream text-blue shadow-lg">
              <div class="card-body flex flex-col items-center">
                <h2 class="text-2xl font-semibold mb-2">
                  üí∞ Investimento com valor de Black Friday:
                </h2>
                <p class="text-lg">
                  De <span class="line-through">R$297</span> por{" "}
                  <span class="text-green font-bold text-2xl"
                    >R$197 √† vista</span
                  >
                </p>
                <p class="text-lg">ou 12x de R$20,38</p>
                <p class="text-2xl font-bold mt-2">
                  üìÜ {warningText}
                </p>
                <p class="text-md mt-2 font-bold text-red-500">
                  üìà Ap√≥s a Black Friday, o pre√ßo vai subir.
                </p>
              </div>
            </div>

            <div class="mt-4">
              <h2 class="text-2xl font-semibold mb-2">
                üí¨ Esse √© o presente que voc√™ merece:
              </h2>
              <div class="card bg-cream text-blue shadow-lg">
                <div class="card-body flex flex-col items-center">
                  <p class="text-lg">N√£o √© mais um curso.</p>
                  <p class="text-lg">√â um m√©todo.</p>
                  <p class="text-lg">√â apoio.</p>
                  <p class="text-lg">√â autonomia.</p>
                  <p class="text-lg">√â o seu leite. Com confian√ßa.</p>
                </div>
              </div>
            </div>
          </div>

          <hr class="w-7/8 border-cream my-4" />
          <div class="mt-4">
            <button
              id="promo"
              class="inline-block bg-green hover:bg-green-dark text-blue font-bold py-3 px-6 rounded-lg text-xl transition duration-300"
            >
              üëâ QUERO ENTRAR NO LACTOFLOW¬Æ AGORA
            </button>
            <p class="text-md mt-2">
              Garanta sua vaga e receba todos os b√¥nus da campanha especial.
            </p>
          </div>
          <hr class="w-7/8 border-cream my-4" />
        </div>
      </div>
      <div class="flex flex-col items-center">
        <p
          class="mx-auto w-[80%] max-w-[600px] text-amber-50 text-center text-[16.67px] font-bold leading-[22.9px] sm:mt-7 sm:px-2 lg:mt-5 lg:text-[18.75px]"
        >
          Assista a essa aula gratuita e comece a aumentar a sua produ√ß√£o de
          leite HOJE MESMO
        </p>
        <div class="flex flex-col items-center lg:flex-row">
          <div class="flex items-center">
            <div class="m-2">
              <img
                class="ml-2 animate-bounce"
                src="/arrow-down.svg"
                alt="one"
                height={36}
                width={36}
              />
            </div>
          </div>
        </div>
      </div>
    </section>

    <YoutubePlayer client:load />

    <script>
      import { isModalOpen, ctaValue } from "../store";

      const modal = document.getElementById("modal") as HTMLDivElement;

      function openModal(cta: string) {
        // add cta to url params
        //add cta to input hidden
        const form = document.querySelector("form");
        if (form) {
          const ctaInput = form.querySelector('input[name="cta"]');
          if (ctaInput) {
            ctaInput.setAttribute("value", cta);
          }
        }

        ctaValue.set(cta);
        if (!modal) return;

        modal.classList.remove("hidden");
      }
      function closeModal() {
        if (!modal) return;
        modal.classList.add("hidden");
      }
      isModalOpen.set(false);
      // set sck equal to utm params concatenated
      const sck = document.getElementById("sck");
      console.log(sck);
      function redirectToHotmart() {
        window.location.href =
          "https://pay.hotmart.com/O84147403X?off=iz9e8l99&sck=" +
          sck?.innerHTML;
      }

      const ctaPromo = document.getElementById("promo");
      if (ctaPromo)
        ctaPromo.addEventListener("click", () => openModal("promo"));

      const cta1 = document.getElementById("1");
      if (cta1) cta1.addEventListener("click", () => openModal("1"));

      const cta2 = document.getElementById("2");
      if (cta2) cta2.addEventListener("click", () => openModal("2"));

      const cta3 = document.getElementById("3");
      if (cta3) cta3.addEventListener("click", () => openModal("3"));

      const cta4 = document.getElementById("4");
      if (cta4) cta4.addEventListener("click", () => openModal("4"));

      const closeBtn = document.getElementById("close");
      if (closeBtn) closeBtn.addEventListener("click", () => closeModal());
    </script>

    <div class="flex flex-col items-center space-y-4 my-4">
      <CTA
        ctaOption="1"
        label="Quero aumentar minha produ√ß√£o de leite com seguran√ßa"
      />
      <Depos />
      <CTA
        ctaOption="2"
        price
        installments={"12"}
        installmentValue={"20,37"}
        total={"197,00"}
        label="Voc√™ tamb√©m pode aumentar a sua produ√ß√£o"
      />
      <Furadeira />
      <Furadeira2 />
      <Bonus />
      <CTA
        ctaOption="3"
        price
        installments={"12"}
        installmentValue={"20,37"}
        total={"197,00"}
        label="Quero garantir minha vaga no LactoFlow com todos os b√¥nus"
      />
      <Conteudo />
      <About />
      <FAQ />
      <CTA
        ctaOption="4"
        price
        installments={"12"}
        installmentValue={"20,37"}
        total={"197,00"}
        label="Sim, eu quero come√ßar com apoio e seguran√ßa"
      />
      <div class="flex flex-col text-center sm:flex-row sm:text-left">
        <span>Copyright ¬© {new Date().getFullYear()}</span>
        <span class="mx-3 hidden sm:block">|</span>
        <span>Todos os direitos reservados.</span>
      </div>
      <a href="/privacy">Pol√≠tica de Privacidade</a>
    </div>

    <div
      id="modal"
      class="hidden fixed inset-0 flex items-start justify-center bg-blue/70 z-10"
    >
      <div
        class="mt-4 w-full max-w-md transform overflow-hidden rounded-2xl bg-green p-6 text-left align-middle shadow-xl transition-all"
      >
        <button id="close" class="text-gray-500 absolute top-2 text-2xl right-6"
          >‚úñ</button
        >
        <PreCheckout clientID={clientUuid?.value} />
      </div>
    </div>
    <div class="fixed bottom-5 right-5 cursor-pointer">
      <div class="relative h-[60px] w-[60px]">
        <a
          target="_blank"
          href="https://wa.me/552139554134?text=Oi%2C+tudo+bem%3F+Eu+tenho+uma+pergunta+sobre+o+curso+LactoFlow."
        >
          <span>
            <img
              width={60}
              height={60}
              alt="whats logo"
              src="/whatsapp-logo.svg"
              decoding="async"
              data-nimg="fill"
            />
          </span>
        </a>
      </div>
    </div>
  </main>
</Layout>
