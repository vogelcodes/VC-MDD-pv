---
import About from "../components/About.astro";
import Bonus from "../components/Bonus.astro";
import CTA from "../components/CTA.astro";
import Depos from "../components/Depos.astro";
import FAQ from "../components/FAQ.astro";
import Furadeira from "../components/Furadeira.astro";
import Posthog from "../components/posthog.astro";
import PreCheckout from "../components/Precheckout.astro";
import YoutubePlayer from "../components/yt-player";
import Layout from "../layouts/Layout.astro";
import { createId } from "@paralleldrive/cuid2";

let uuid = createId();
if (!Astro.cookies.get("uuid")) {
  Astro.cookies.set("uuid", uuid, {
    maxAge: 365 * 24 * 60 * 60,
    path: "/",
  });
}
let clientUuid = Astro.cookies.get("uuid");

// console.log(clientUuid);
---

<Layout>
  <main class="max-w-[1080px] mx-auto">
    <script is:inline>
      window.posthog.capture("pageview");
    </script>
    <!-- <div
      class="text-md font-bold text-center text-cream bg-red-400 fixed top-0 left-0 w-full z-10"
    >
      R$100 OFF - Até 16/07/2025 21:59 (horário de Brasília)
    </div> -->
    <header class="flex flex-col items-center">
      <div class="w-[180px] sm:w-[300px]">
        <img src="/logo-portrait-v2.svg" alt="logo" width={300} height={120} />
      </div>

      <h1
        class="mt-4 px-4 text-center rounded-md text-lg uppercase text-blue bg-cream sm:w-lg sm:px-0 sm:text-[24px]"
      >
        Se você precisa:
      </h1>
      <div
        class="my-4 font-bold pl-2 flex flex-col items-center gap-4 uppercase text-xl leading-none text-cream text-center sm:text-[24px]"
      >
        <h1>
          <span class="text-2xl uppercase text-green sm:text-[35px]">
            Aumentar</span
          >
          <span class=""> sua <br class="sm:hidden" />produção de leite</span>
        </h1>

        <h1>
          <span class="text-2xl text-red-400 uppercase sm:text-[35px]">
            Eliminar</span
          > a fórmula
        </h1>

        <h1>
          ou criar um <span class="text-2xl text-green uppercase sm:text-[35px]"
            >estoque<br class="sm:hidden" /></span
          >
          de leite materno
        </h1>
      </div>
      <p
        class="mx-auto w-[80%] max-w-[600px] p-4 rounded-md text-blue bg-cream text-center text-sm sm:mt-7 sm:px-2 lg:mt-5 sm:text-[20px]"
      >
        Nesta <span class="text-md font-bold text-green sm:text-[24px]">
          AULA GRATUITA
        </span>
        você vai aprender <br class="hidden sm:block" />as<span
          class="text-md font-bold uppercase no-break text-red-400 sm:text-[24px]"
        >
          4 técnicas</span
        > que ajudaram MILHARES de mães a recuperarem sua produção de leite.
      </p>
      <!-- <ul class="text-cream list-disc text-sm my-2 pl-2 text-left">
        <li>Recuperarem a produção</li>
        <li>Saírem da fórmula</li>
        <li>Montarem seus estoques de leite materno</li>
      </ul> -->
      <p
        class="text-amber-50 text-center text-[16.67px] font-bold leading-[22.9px] sm:mt-7 sm:px-2 lg:mt-5 lg:text-[18.75px]"
      >
      </p>
    </header>

    <div class="flex flex-col items-center lg:flex-row">
      <div class="flex items-center">
        <div class="m-2">
          <img
            class="ml-2 animate-bounce"
            src="/arrow-down.svg"
            alt="one"
            height={36}
            width={36}
          />
        </div>
      </div>
    </div>
    <!-- <div>
        <iframe
        width="560"
        height="315"
        src="https://www.youtube.com/embed/eXp3-bclWPs?si=H8oYqN9H72Zq0FvQ"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen></iframe>
        </div> -->
  </main>

  <YoutubePlayer client:load />

  <script>
    import { isModalOpen, ctaValue } from "../store";

    const modal = document.getElementById("modal") as HTMLDivElement;

    function openModal(cta: string) {
      // add cta to url params
      //add cta to input hidden
      const form = document.querySelector("form");
      if (form) {
        const ctaInput = form.querySelector('input[name="cta"]');
        if (ctaInput) {
          ctaInput.setAttribute("value", cta);
        }
      }

      ctaValue.set(cta);
      if (!modal) return;

      modal.classList.remove("hidden");
    }
    function closeModal() {
      if (!modal) return;
      modal.classList.add("hidden");
    }
    isModalOpen.set(false);

    const cta1 = document.getElementById("1");
    if (cta1) cta1.addEventListener("click", () => openModal("1"));

    const cta2 = document.getElementById("2");
    if (cta2) cta2.addEventListener("click", () => openModal("2"));

    const cta3 = document.getElementById("3");
    if (cta3) cta3.addEventListener("click", () => openModal("3"));

    const cta4 = document.getElementById("4");
    if (cta4) cta4.addEventListener("click", () => openModal("4"));

    const closeBtn = document.getElementById("close");
    if (closeBtn) closeBtn.addEventListener("click", () => closeModal());
  </script>

  <div class="flex flex-col items-center space-y-4 my-4">
    <CTA
      ctaOption="1"
      label="Quero aumentar minha produção de leite com segurança"
    />
    <Depos />
    <CTA ctaOption="2" label="Você também pode aumentar a sua produção" />
    <Furadeira />
    <Bonus />
    <CTA
      ctaOption="3"
      price
      label="Quero garantir minha vaga no LactoFlow com todos os bônus"
    />
    <About />
    <FAQ />
    <CTA
      ctaOption="4"
      price
      label="Sim, eu quero começar com apoio e segurança"
    />
    <div class="flex flex-col text-center sm:flex-row sm:text-left">
      <span>Copyright © {new Date().getFullYear()}</span>
      <span class="mx-3 hidden sm:block">|</span>
      <span>Todos os direitos reservados.</span>
    </div>
  </div>

  <div
    id="modal"
    class="hidden fixed inset-0 flex items-start justify-center bg-blue/70 z-10"
  >
    <div
      class="mt-4 w-full max-w-md transform overflow-hidden rounded-2xl bg-green p-6 text-left align-middle shadow-xl transition-all"
    >
      <button id="close" class="text-gray-500 absolute top-2 text-2xl right-6"
        >✖</button
      >
      <PreCheckout clientID={clientUuid?.value} />
    </div>
  </div>
  <div class="fixed bottom-5 right-5 cursor-pointer">
    <div class="relative h-[60px] w-[60px]">
      <a
        target="_blank"
        href="https://wa.me/5521978001294?text=Oi%2C+tudo+bem%3F+Eu+tenho+uma+pergunta+sobre+o+curso+LactoFlow."
      >
        <span>
          <img
            width={60}
            height={60}
            alt="whats logo"
            src="/whatsapp-logo.svg"
            decoding="async"
            data-nimg="fill"
          />
        </span>
      </a>
    </div>
  </div>
</Layout>
